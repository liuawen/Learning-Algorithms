# 线程和线程池面试题
### 问：什么是进程？

**参考答案：**

是一个具有一定独立功能的程序在一个数据集上的一次动态执行的过程，是操作系统进行资源分配和调度的一个独立单位，是应用程序运行的载体。

### 问：什么是线程？

**参考答案：**

线程是操作系统能够进行运算调度的最小单位。

它被包含在进程之中，是进程中的实际运作单位。

一条线程指的是进程中一个单一顺序的控制流，一个进程中可以并发多个线程，每条线程并行执行不同的任务。

### 问：进程和线程的区别？

**参考答案：**

进程和线程的主要差别在于它们是不同的操作系统资源管理方式。

进程有独立的地址空间，一个进程崩溃后，在保护模式下不会对其它进程产生影响。

线程只是一个进程中的不同执行路径。线程有自己的堆栈和局部变量，但线程之间没有单独的地址空间，一个线程死掉就等于整个进程死掉，所以多进程的程序要比多线程的程序健壮，但在进程切换时，耗费资源较大，效率要差一些。

但对于一些要求同时进行并且又要共享某些变量的并发操作，只能用线程，不能用进程。

### 问：多线程和单线程有什么区别？

**参考答案：**

单线程程序：程序执行过程中只有一个有效操作的序列，不同操作之间都有明确的执行先后顺序，容易出现代码阻塞

多线程程序：有多个线程，线程间独立运行，能有效地避免代码阻塞，并且提高程序的运行性能

### 问：为什么要使用多线程？

**参考答案：**

1、使用多线程可以减少程序的响应时间。 在单线程的情况下，如果某个程序很耗时或者陷入长时间等待（如等待网络响应），此时程序将不会相应鼠标和键盘等操作，使用多线程后，可以把这个耗时的线程分配到一个单独的线程去执行，从而是程序具备了更好的交互性。

2、与进程相比，线程的创建和切换开销更小。 由于启动一个新的线程必须给这个线程分配独立的地址空间，建立许多数据结构来维护线程代码段、数据段等信息，而运行于同一个进程内的线程共享代码段、数据段，线程的启动或切换的开销就比进程要少很多。同时多线程在数据共享方面效率非常高。

3、多CPU或多核心计算机本身就具有执行多线程的能力。 如果使用单个线程，将无法重复利用计算机资源，造成资源的巨大浪费。因此在多CPU计算机上使用多线程能提高CPU的利用率。

4、使用多线程能简化程序的结构，使用程序便于理解和维护。 一个非常复杂的进程可以分成多个线程来执行。



### 问：什么是线程安全？

**参考答案：**

当多个线程访问同一个对象时，如果不用考虑这些线程在运行时环境下的调度和交替运行，也不需要进行额外的同步，或者在调用方进行任何其他的协调操作，调用这个对象的行为都可以获取正确的结果，那这个对象是线程安全的。

### 问：为何要使用线程同步？

**参考答案：**

Java允许多线程并发控制，当多个线程同时操作一个可共享的资源变量时（如数据的增删改查），将会导致数据不准确，相互之间产生冲突。

因此加入同步锁以避免在该线程没有完成操作之前，被其他线程的调用，从而保证了该变量的唯一性和准确性。

### 问：如何确保线程安全？


1、对非安全的代码进行加锁控制；

2、使用线程安全的类；

3、多线程并发情况下，线程共享的变量改为方法级的局部变量



### 问：线程安全的级别？

**参考答案：**

1、不可变。不可变的对象一定是线程安全的，并且永远也不需要额外的同步。

> Java类库中大多数基本数值类如Integer、String和BigInteger都是不可变的。


2、无条件的线程安全。由类的规格说明所规定的约束在对象被多个线程访问时仍然有效，不管运行时环境如何排列，线程都不需要任何额外的同步。

> 如 Random 、ConcurrentHashMap、Concurrent集合、atomic

3、有条件的线程安全。有条件的线程安全类对于单独的操作可以是线程安全的，但是某些操作序列可能需要外部同步。

> 有条件线程安全的最常见的例子是遍历由 Hashtable 或者 Vector 或者返回的迭代器

4、非线程安全(线程兼容)。线程兼容类不是线程安全的，但是可以通过正确使用同步而在并发环境中安全地使用。

> 如ArrayList HashMap

5、线程对立。线程对立是那些不管是否采用了同步措施，都不能在多线程环境中并发使用的代码。

> 如如System.setOut()、System.runFinalizersOnExit()



### 问：为什么我们调用 start() 方法时会执行 run() 方法，为什么我们不能直接调用 run() 方法？

**参考答案：**

new 一个 Thread，线程进入了新建状态(NEW)；调用 start() 方法，会启动一个线程并使线程进入了就绪状态(READY)，当分配到时间片后就可以开始运行了。 start() 会执行线程的相应准备工作，然后自动执行 run() 方法的内容，这是真正的多线程工作。 而直接执行 run() 方法，会把 run 方法当成一个 main 线程下的普通方法去执行，并不会在某个线程中执行它，所以这并不是多线程工作。

**总结： 调用 start 方法方可启动线程并使线程进入就绪状态，而 run 方法只是 thread 的一个普通方法调用，还是在主线程里执行。**

##  

### 问：使用多线程可能带来什么问题?

**参考答案：**

多线程的目的就是为了能提高程序的执行效率提高程序运行速度，但也可能会遇到很多问题：内存泄漏、上下文切换、死锁还有受限于硬件和软件的资源闲置问题。



### 问：线程池有哪些状态?

**参考答案：**

线程池的5种状态：Running、ShutDown、Stop、Tidying、Terminated。

1. **RUNNING** ：能接受新提交的任务，并且也能处理阻塞队列中的任务；
2. **SHUTDOWN**：关闭状态，不再接受新提交的任务，但却可以继续处理阻塞队列中已保存的任务。在线程池处于 RUNNING 状态时，调用 shutdown()方法会使线程池进入到该状态。；
3. **STOP**：不能接受新任务，也不处理队列中的任务，会中断正在处理任务的线程。在线程池处于 RUNNING 或 SHUTDOWN 状态时，调用 shutdownNow() 方法会使线程池进入到该状态；
4. **TIDYING**：如果所有的任务都已终止了，workerCount (有效线程数) 为0，线程池进入该状态后会调用 terminated() 方法进入TERMINATED 状态。
5. **TERMINATED**：在terminated() 方法执行完后进入该状态，默认terminated()方法中什么也没有做。

  线程流转如下：
![扩展面试题_线程池状态转换.jpg](https://i.loli.net/2020/03/10/V6eLcxs5jdC9Hrm.jpg)

**注意线程池的状态和线程的状态**

###  

### 问：线程池中 execute()和submit()方法有什么区别？

**参考答案：**

 1、execute方法用于提交不需要返回值的任务，所以无法判断任务是否被线程池执行成功与否;

 2、submit()方法用于提交需要返回值的任务。线程池会返回一个Future类型的对象，通过这个Future对象可以判断任务是否执行成功，并且可以通过future的get()方法来获取返回值，get()方法会阻塞当前线程直到任务完成，而使用get（long timeout，TimeUnit unit）方法则会阻塞当前线程一段时间后立即返回，这时候有可能任务没有执行完。



### 问：实现Runnable接口和Callable接口的区别？

**参考答案：**

两者的区别在于 Runnable 接口不会返回结果但是 Callable 接口可以返回结果。

备注： 工具类Executors可以实现Runnable对象和Callable对象之间的相互转换。（Executors.callable（Runnable task）或Executors.callable（Runnable task，Object resule））。



###  

### 问: 创建线程有哪些方式？

**参考答案：**

1、继承 Thread 类创建线程类；

2、通过 Runnable 接口创建线程类。

3、通过 Callable 和 Future 创建线程。

4、线程池



### 问：线程池的拒绝策略有哪些？

**参考答案：**

1、AbortPolicy：默认的拒绝策略，直接抛出 RejectedExecutionException 异常；

2、CallerRunsPolicy：既不会抛弃任务，也不会抛出异常，由调用线程处理该任务；

3、DiscardPolicy: 直接丢弃任务，不予处理也不抛出异常。如果允许任务丢失，是最好的处理策略。

4、DiscardOldestPolicy: 抛弃队列中等待最久的任务，然后把当前任务加入队列尝试再次提交（可能会再次失败，导致重复）。
