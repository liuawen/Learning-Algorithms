# redis面试题

### 问：使用 Redis 有哪些好处？

**参考答案：**

（1）速度快，因为数据存在内存中，类似于 HashMap，HashMap 的优势就是查找和操作的时间复杂度都是 O1)

（2）支持丰富数据类型，支持 string，list，set，Zset，hash 等

（3）支持事务，操作都是原子性，所谓的原子性就是对数据的更改要么全部执行，要么全部不执行

（4）丰富的特性：可用于缓存，消息，按 key 设置过期时间，过期后将会自动删除



### 问：Redis 是单进程单线程的？

**参考答案：**

Redis 是单进程单线程的，redis 利用队列技术将并发访问变为串行访问，消除了传统数据库串行控制的开销。

### 问：一个字符串类型的值能存储最大容量是多少？
**参考答案：** 512M


### 问：Redis 常见性能问题和解决方案有哪些？

**参考答案：**

（1）Master 最好不要写内存快照，如果 Master 写内存快照，save 命令调度 rdbSave函数，会阻塞主线程的工作，当快照比较大时对性能影响是非常大的，会间断性暂停服务；

（2）如果数据比较重要，某个 Slave 开启 AOF 备份数据，策略设置为每秒同步一次；

（3）为了主从复制的速度和连接的稳定性，Master 和 Slave 最好在同一个局域网；

（4）尽量避免在压力很大的主库上增加从库；

###  

### 问：为什么redis 需要把所有数据放到内存中？

**参考答案：**

Redis 为了达到最快的读写速度将数据都读到内存中，并通过异步的方式将数据写入磁盘。所以 redis 具有快速和数据持久化的特征。如果不将数据放在内存中，磁盘 I/O 速度为严重影响 redis 的性能。在内存越来越便宜的今天，redis 将会越来越受欢迎。如果设置了最大使用的内存，则数据已有记录数达到内存限值后不能继续插入新值。



### 问：Redis 支持的 Java 客户端都有哪些？官方推荐用哪个？

**参考答案：**

Redisson、Jedis、lettuce 等等，官方推荐使用 Redisson。

###  

### 问：Jedis 与 Redisson 对比有什么优缺点？

**参考答案：**

Jedis 是 Redis 的 Java 实现的客户端，其 API 提供了比较全面的 Redis 命令的支持；Redisson 实现了分布式和可扩展的 Java 数据结构，和 Jedis 相比，功能较为简单，不支持字符串操作，不支持排序、事务、管道、分区等 Redis 特性。

Redisson 的宗旨是促进使用者对 Redis 的关注分离，从而让使用者能够将精力更集中地放在处理业务逻辑上。



### 问：说说 Redis 哈希槽的概念？

**参考答案：**

Redis 集群没有使用一致性 hash,而是引入了哈希槽的概念，Redis 集群有16384 个哈希槽，每个 key 通过 CRC16 校验后对 16384 取模来决定放置哪个槽，集群的每个节点负责一部分 hash 槽。



### 问：Redis 集群会有写操作丢失吗？为什么？

**参考答案：**

Redis 并不能保证数据的强一致性，这意味这在实际中集群在特定的条件下可能会丢失写操作。



### 问：Redis 集群之间是如何复制的？

**参考答案**：异步复制

###  

### 问：Redis 集群最大节点个数是多少？

**参考答案**：16384 个。



### 问：Redis 事务相关的命令有哪几个？

**参考答案**：MULTI、EXEC、DISCARD、WATCH



### 问：Redis key 的过期时间和永久有效分别怎么设置？

**参考答案**：EXPIRE 和 PERSIST 命令。



### 问：Redis 如何做内存优化？

**参考答案**：尽可能使用散列表（hashes），散列表（是说散列表里面存储的数少）使用的内存非常小，所以你应该尽可能的将你的数据模型抽象到一个散列表里面。比如你的 web 系统中有一个用户对象，不要为这个用户的名称，姓氏，邮箱，密码设置单独的 key,而是应该把这个用户的所有信息存储到一张散列表里面。

###  

###  

### 问：都有哪些办法可以降低 Redis 的内存使用情况呢？

**参考答案**：如果你使用的是 32 位的 Redis 实例，可以好好利用 Hash,list,sorted set,set等集合类型数据，因为通常情况下很多小的 Key-Value 可以用更紧凑的方式存放到一起。

###  

### 问：Redis 的内存用完了会发生什么？

**参考答案**：如果达到设置的上限，Redis 的写命令会返回错误信息（但是读命令还可以正常返回。）或者你可以将 Redis 当缓存来使用配置淘汰机制，当 Redis 达到内存上限时会冲刷掉旧的内容。

###  

### 问：一个 Redis 实例最多能存放多少的 keys？List、Set、Sorted Set 他们最多能存放多少元素？

**参考答案**：理论上 Redis 可以处理多达 232 的 keys，每个实例至少存放了 2 亿 5 千万的 keys。任何 list、set、和 sorted set 都可以放 232 个元素。换句话说，Redis 的存储极限是系统中的可用内存值。

###  

### 问：Redis 最适合的场景？

**参考答案：**

1、会话缓存（Session Cache）

最常用的一种使用 Redis 的情景是会话缓存（session cache）。用 Redis 缓存会话比其他存储（如 Memcached）的优势在于：Redis 提供持久化。

2、全页缓存（FPC）

除基本的会话 token 之外，Redis 还提供很简便的 FPC 平台。回到一致性问题，即使重启了 Redis 实例，因为有磁盘的持久化，用户也不会看到页面加载速度的下降，这是一个极大改进，类似 PHP 本地 FPC。能帮助你以最快速度加载你曾浏览过的页面。

3、队列

Reids 在内存存储引擎领域的一大优点是提供 list 和 set 操作，这使得 Redis能作为一个很好的消息队列平台来使用。Redis 作为队列使用的操作，就类似于本地程序语言（如 Python）对 list 的 push/pop 操作。

4，排行榜/计数器

Redis 在内存中对数字进行递增或递减的操作实现的非常好。集合（Set）和有序集合（Sorted Set）也使得我们在执行这些操作的时候变的非常简单，Redis 只是正好提供了这两种数据结构。所以，我们要从排序集合中获取到排名最靠前的 10个用户，我们只需要像下面一样执行即可： 当然，这是假定你是根据你用户的分数做递增的排序。如果你想返回用户及用户的分数，你需要这样执行： ZRANGE user_scores 0 10 WITHSCORES。

5、发布/订阅

最后（但肯定不是最不重要的）是 Redis 的发布/订阅功能。发布/订阅的使用场景确实非常多。在社交网络中甚至可以用 Redis 的发布/订阅功能来建立聊天系统！



### 问：假如 Redis 里面有 1 亿个 key，其中有 10w 个 key 是以某个固定的已知的前缀开头的，如果将它们全部找出来？

**参考答案：**

使用 keys 指令可以扫出指定模式的 key 列表。

*对方接着追问：如果这个 redis 正在给线上的业务提供服务，那使用 keys 指令会有什么问题？*

这个时候你要回答 redis 关键的一个特性：redis 的单线程的。keys 指令会导致线程阻塞一段时间，线上服务会停顿，直到指令执行完毕，服务才能恢复。这个时候可以使用 scan 指令，scan 指令可以无阻塞的提取出指定模式的 key 列表，但是会有一定的重复概率，在客户端做一次去重就可以了，但是整体所花费的时间会比直接用 keys 指令长。

###  

### 问：如果有大量的 key 需要设置同一时间过期，一般需要注意什么？

**参考答案：**

如果大量的 key 过期时间设置的过于集中，到过期的那个时间点，redis 可能会出现短暂的卡顿现象。一般需要在时间上加一个随机值，使得过期时间分散一些。

###  

### 问：使用过 Redis 做异步队列么，你是怎么用的？

**参考答案：**

一般使用 list 结构作为队列，rpush 生产消息，lpop 消费消息。当 lpop 没有消息的时候，要适当 sleep 一会再重试。如果对方追问可不可以不用 sleep 呢？list 还有个指令叫 blpop，在没有消息的时候，它会阻塞住直到消息到来。

*如果对方追问能不能生产一次消费多次呢？*

使用 pub/sub 主题订阅者模式，可以实现1:N 的消息队列。

*如果对方追问 pub/sub 有什么缺点？*

在消费者下线的情况下，生产的消息会丢失，得使用专业的消息队列如 RabbitMQ等。

*如果对方追问 redis 如何实现延时队列？*

使用 sortedset，拿时间戳作为score，消息内容作为 key 调用 zadd 来生产消息，消费者用 zrangebyscore 指令获取 N 秒之前的数据轮询进行处理。





### 问：redis是单线程为啥那么快？

**参考答案：**

1、完全基于内存，绝大部分请求是纯粹的内存操作，非常快速。数据存在内存中，类似于HashMap，HashMap的优势就是查找和操作的时间复杂度都是O(1)；

2、数据结构简单，对数据操作也简单，Redis中的数据结构是专门进行设计的；

3、采用单线程，避免了不必要的上下文切换和竞争条件，也不存在多进程或者多线程导致的切换而消耗 CPU，不用去考虑各种锁的问题，不存在加锁释放锁操作，没有因为可能出现死锁而导致的性能消耗；

4、使用多路I/O复用模型，非阻塞IO；

5、使用底层模型不同，它们之间底层实现方式以及与客户端之间通信的应用协议不一样，Redis直接自己构建了VM 机制 ，因为一般的系统调用系统函数的话，会浪费一定的时间去移动和请求；

###  

### 问：redis的支持哪些集群模式？

**参考答案：**

1、Master-Slaver主从模式：

![主从模式.png](https://i.loli.net/2020/04/08/UzCeK2mAV1fuL8F.png) 

 	主从模式就是N个redis实例，可以是1主N从，也可以N主N从（N主N从则不是严格意义上的主从模式了，N主N从就是N+N个redis实例）

  	优点：1.备份数据，这样当一个节点损坏（指不可恢复的硬件损坏）时，数据因为有备份，可以方便恢复。

2.负载均衡，所有客户端都访问一个节点肯定会影响Redis工作效率，有了主从以后，查询操作就可以通过查询从节点来完成。

  	缺点：master节点挂了以后，redis就不能对外提供写服务了，因为剩下的slave不能成为master。

  	使用场景：读请求较多场景



2、Sentinel哨兵模式：

![哨兵模式.png](https://i.loli.net/2020/04/08/gtWeYRxz7h8y2VF.png)

主从模式中slave节点不能主动选举一个master节点出来，那么就安排一个或多个sentinel来做这件事，当sentinel发现master节点挂了以后，sentinel就会从slave中重新选举一个master。

优点：解决了主从模式下master挂了无法提供写服务的情况

缺点：当数据量过大到一台服务器存放不下的情况（内存不够时），主从模式或sentinel模式就不能满足需求了

使用场景：存储量不大，单机可承受。



3、Cluster集群模式：

![集群模式.png](https://i.loli.net/2020/04/08/6lZGMdvFatqxpXN.png)

cluster的出现是为了解决单机Redis容量有限的问题，将Redis的数据根据一定的规则分配到多台机器。一个 Redis 集群包含 16384 个哈希槽（hash slot），数据库中的每个键都属于这 16384 个哈希槽的其中一个，集群中的每个节点负责处理一部分哈希槽。

优点：解决了数据量较大，单机不够存储的情况，高并发高可用

使用场景：数据量大，高并发场景





### 问：Redis 集群方案什么情况下会导致整个集群不可用？

**参考答案：**

有 A，B，C 三个节点的集群,在没有复制模型的情况下,如果节点 B 失败了，那么整个集群就会以为缺少 5501-11000 这个范围的槽而不可用。
